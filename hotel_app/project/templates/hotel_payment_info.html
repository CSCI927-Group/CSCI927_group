{% extends 'layout.html' %}

{% block title %}Payment{% endblock %}

{% block content %}
<div class="container col-xl-10 col-xxl-8 px-4 py-5">
  <div class="row g-lg-5 py-5">
      <!-- Use POST method to collect email and card details -->
      <form method="PUT" class="needs-validation" onpay="return onPay(this)">
        <h4 class="mb-3">Payment</h4>

        <!-- Email Field (required)
        <div class="mb-3">
          <label for="email" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="email" name="email" required placeholder="you@example.com">
          <div class="invalid-feedback">
            Please enter a valid email address.
          </div>
        </div> -->

        <!-- Card Details -->
        <div class="row gy-3">
          <div class="col-md-6">
            <label for="cc-name" class="form-label">Name on Card</label>
            <input type="text" class="form-control" id="cc-name" name="cc_name" required placeholder="">
            <small class="text-body-secondary">Full name as displayed on card</small>
            <div class="invalid-feedback">
              Name on card is required
            </div>
          </div>

          <div class="col-md-6">
            <label for="cc-number" class="form-label">Credit Card Number</label>
            <input type="text" class="form-control" id="cc-number" name="cc_number" required placeholder="">
            <div class="invalid-feedback">
              Credit card number is required
            </div>
          </div>

          <div class="col-md-3">
            <label for="cc-expiration" class="form-label">Expiration</label>
            <input type="text" class="form-control" id="cc-expiration" name="cc_expiration" required placeholder="MM/YY">
            <div class="invalid-feedback">
              Expiration date is required
            </div>
          </div>

          <div class="col-md-3">
            <label for="cc-cvv" class="form-label">CVV</label>
            <input type="text" class="form-control" id="cc-cvv" name="cc_cvv" required placeholder="">
            <div class="invalid-feedback">
                Security code is required
            </div>
        </div>
        

        <hr class="my-4">

        <!-- Continue to Payment Button -->
        <button class="w-100 btn btn-lg btn-primary" type="submit">Continue to Pay</button>
      </form>
    </div>
</div>
<script>
    function onPay(self) {
    event.preventDefault();
    const data = new FormData(self);
    data.set('price', document.getElementById('price').innerText);
    fetch('{{ url_for('app.order_add') }}', { method: 'PUT', body: data })
      .then(res => res.text()).then(res => {
        alert(res); // Alert the success message
        location.href = '{{ url_for('app.hotel_payment_success') }}?order_id=' + document.getElementById('id').value; // Redirect to payment info
      });
    }
</script>
{% endblock %}
