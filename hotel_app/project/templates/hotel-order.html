{% extends 'layout.html' %}

{% block title %}Accommodations Availability{% endblock %}

{% block content %}
<div class="container col-xl-10 col-xxl-8 px-4 py-5">
  <h2 class="mb-4">Select details to book</h2>

  <form method="POST" class="needs-validation" onsubmit="return onSubmit(this)">
    <div class="mb-3">
      <label for="start-date" class="form-label">Start Date</label>
      <input type="date" class="form-control" id="start-date" name="startDate" required>
      <div class="invalid-feedback">
        Please select a valid start date.
      </div>
    </div>

    <div class="mb-3">
      <label for="end-date" class="form-label">End Date</label>
      <input type="date" class="form-control" id="end-date" name="endDate" required>
      <div class="invalid-feedback">
        Please select a valid end date.
      </div>
    </div>

    <div class="mb-3">
      <label for="number-of-people" class="form-label">Number of People</label>
      <input type="number" class="form-control" id="people" name="people" required placeholder="1" min="1">
      <div class="invalid-feedback">
        Please enter the number of people.
      </div>
    </div>

    <div class="mb-3">
      <label for="price" class="form-label">Price</label>
      <input type="text" class="form-control" id="price" name="price" placeholder="0.00" disabled>
      <div class="invalid-feedback">
        Please enter a valid price.
      </div>
    </div>

    <input type="hidden" id="id" name="id">
    <button class="w-100 btn btn-lg btn-primary" type="submit">Confirm Booking</button>
  </form>

  <ul class="list-group mt-4">
    {% for accommodation in accommodations %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{ accommodation.date }}</span>
      <span class="{% if accommodation.available %}text-success{% else %}text-danger{% endif %}">
        {% if accommodation.available %}Available{% else %}Sold Out{% endif %}
      </span>
      <a href="{{ url_for('payment') }}" 
         class="btn {% if accommodation.available %}btn-primary{% else %}btn-secondary disabled{% endif %}" 
         {% if not accommodation.available %}aria-disabled="true" disabled{% endif %}>
         {% if accommodation.available %}Book Now{% else %}Sold Out{% endif %}
      </a>
    </li>
    {% endfor %}
  </ul>
</div> 
<script>
const urlParams = new URLSearchParams(location.search)
document.getElementById('id').value = urlParams.get('id')
document.getElementById('price').value = urlParams.get('price')

document.querySelector('#people').addEventListener('input', function() {
  const days = 1 // 
  document.getElementById('price').value = urlParams.get('price') * days
})

function onSubmit(self) {
    event.preventDefault()
    const data = new FormData(self)
    // const route = data.get('route')
    // if (!route) {
    //   return alert('Please select route')
    // }

    fetch('{{ url_for('app.order_add') }}', { method: 'POST', body: data })
      .then(res => res.text()).then(res => {
        try {
          location.replace('{{ url_for('app.hotel_payment_info') }}')
        } catch(e) {
          console.log(e)
          alert(res)
        }
      })
  }
</script>
{% endblock %}
