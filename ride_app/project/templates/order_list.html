{% extends 'framework.html' %}
{% block title %}Order List{% endblock %}

{% block body %}
<div class="col-lg-8 mx-auto my-5">
  <div class="row g-3 align-items-center">
    <div class="col-auto">
      <label class="col-form-label">User Name:</label>
      <span>{{ user.name }}</span>
    </div>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Ride Route</th>
        <th scope="col">Price</th>
        <th scope="col">State</th>
        <th scope="col">Date</th>
        <th scope="col">Operate</th>
      </tr>
    </thead>
    <tbody>
      {% for item in list %}
      <tr>
        <th>{{ item.name }}</th>
        <th>${{ item.price }}</th>
        <th>{{ order_state[item.state] }}</th>
        <th>{{ item.datestr }}</th>
        <th>
          <button class="btn btn-primary btn-sm" onclick="onView({{ item.id }}, {{ item.state }})">
            <i class="bi bi-eye"></i> View
          </button>
          <button class="btn btn-danger btn-sm" onclick="onDelete({{ item.id }})">
            <i class="bi bi-trash"></i> Delete
          </button>
        </th>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
function onView(id, state) {
  if (state == 1 || state == 5 || state == 6) {
    location.href = `{{ url_for('app.ride_payment') }}?id=${id}`
  } else if (state == 2) { // paid
    location.href = `{{ url_for('app.ride_location') }}?id=${id}`
  } else if (state == 3) { // onboard
    location.href = `{{ url_for('app.ride_onboard') }}?id=${id}`
  } else if (state == 4) { // complete
    location.href = `{{ url_for('app.ride_complete') }}?id=${id}`
  }
}

function onDelete(id){
  fetch(`{{ url_for('app.order_delete') }}?id=${id}`, { method: 'DELETE' })
  .then(json=>json.text()).then(res => {
    alert(res)
    location.reload()
  })
}
</script>
{% endblock %}